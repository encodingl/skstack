{% extends 'base.html' %}
{% load mytags %}
{% block self_head_css_js %}
    <script src="/static/layer/layer.js"></script>
    <script src="/static/js/base.js"></script>
    <style>
        textarea {
            border: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
        }
    </style>
{% endblock %}


{% block content %}
<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
    </section>

    <!-- Main content -->
    <section class="content">
        <form action="{% url 'monitor_userdel' %}" method="post">
            {% csrf_token %}
            <div class="box">
                <div class="box-header">
                    <div class="btn-group">
                        <a href="{% url 'monitor_groupadd' %}">
                            <li class="btn btn-success"><b>添加告警分组</b></li>
                        </a>
                    </div>
                </div>
                <!-- /.box-header -->
                <div class="box-body">
                    <table class="table table-striped table-bordered" id="dataform">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>名称</th>
                            <th>用户数量</th>
                            <th>微信通道</th>
                            <th>Token数量</th>
                            <th>监控范围</th>
                            <th class="text-center">功能</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% if obj_info %}
                        {% for obj in obj_info %}
                        <tr class="even gradeX">
                            <td width="3%" style="vertical-align:middle">{{ obj.id }}</td>
                            <td width="20%" style="vertical-align:middle"><a href="#">
                                <li style="list-style-type:none" onclick="return tanchu(this.value)"
                                    value="{{ obj.id }}"> {{ obj.name }}</li>
                            </a></td>
                            <td width="8%" style="vertical-align:middle">
                                {{ obj.user.count }}
{#                                {% for i in obj.user.all %}#}
{#                                    {{ i|get_user }}<br>#}
{#                                {% endfor %}#}
                            </td>
                            <td width="8%" style="vertical-align:middle">{{ obj.serial }}</td>
                            <td width="10%" style="vertical-align:middle">{{ obj.tokens.count }}</td>
                            <td width="20%" style="vertical-align:middle">{{ obj.descrition }}</td>
                            <td width="10%" style="vertical-align:middle" class="text-center" data-editable='false'>
                                <a href="#">
                                    <li class="btn btn-sm btn-info" onclick="return tanchu(this.value)"
                                        value="{{ obj.id }}">编辑
                                    </li>
                                </a>
                                <a value="{% url 'monitor_groupdel' %}?id={{ obj.id }}"
                                   class="btn btn-sm btn-danger del">删除</a>
                            </td>
                        </tr>
                        {% endfor %}
                        {% else %}
                        <p>No Item are available.</p>
                        {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </form>

    </section>
    <!-- /.content -->
</div>
{#接收子层回传参数#}
<input id="handle_status" value="" hidden="hidden">
<script>
    function checkAll(sender, checkClass) {
        var checkItems = document.getElementsByTagName('input');
        for (var i = 0; i < checkItems.length; i++) {
            var checkItem = checkItems[i];
            if (checkItem.type === 'checkbox' && checkItem.className === 'item1') {
                checkItem.checked = sender.checked;
            }
        }
    }
</script>
<script src="/static/plugins/datatables/jquery.dataTables.min.js"></script>
<script src="/static/plugins/datatables/dataTables.bootstrap.min.js"></script>
<script>
    var Table = $('#dataform').DataTable({
        "paging": true,
        "lengthChange": true,
        "searching": true,
        "ordering": true,
        "info": true,
        "autoWidth": true
    });

    $(function(){
        $("textarea").each(function(index, el){
            $(this).css("height", $(this).scrollHeight);
        })
    });

</script>
<script>
    function checkSubmit() {
        var app_id_all = getIDall();
        if (app_id_all == '') {
            alert("请至少选择一行!");
            return false;
        }
        if (!confirm("确定删除？")) {
            window.event.returnValue = false;
        }
    }
</script>
<script>
    function tanchu(n) {
        layer.open({
            type: 2,
            title: '编辑告警分组信息',
            area: ['600px', '450px'],
            shadeClose: true, //点击遮罩关闭
            content: ['/skapi/monitor/groupedit/' + n,],
            end: function () {
                var handle_status = $("#handle_status").val();
                if (handle_status == '1') {
                    layer.msg('保存成功！', {
                        icon: 1,
                        time: 2000 //2秒关闭（如果不配置，默认是3秒）
                    }, function () {
                        history.go(0);
                    });
                    window.location = "{% url 'monitor_grouplist' %}"
                } else if (handle_status == '2') {
                    layer.msg('修改失败！', {
                        icon: 2,
                        time: 2000 //2秒关闭（如果不配置，默认是3秒）
                    }, function () {
                        history.go(0);
                    });
                }
            }
        });
    }
</script>
<script>
    $(document).ready(function () {
        $('.del').click(function () {
            var row = $(this).closest('tr');
            if (confirm("确定删除?")) {
                $.get(
                        $(this).attr('value'),
                        {},
                        function (data) {
                            row.remove()
                        }
                )
            }
        });

    });
</script>
{% endblock %}
