{% extends 'base.html' %}
{% load mytags %}
{% block self_head_css_js %}
    <script src="/static/layer/layer.js"></script>
    <script src="/static/js/base.js"></script>
{% endblock %}
{% block content %}


<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
    </section>

    <!-- Main content -->
    <section class="content">
        <form action="{% url 'hostgroup_del' %}" method="post" id="form">
            {% csrf_token %}
            <div class="box">
                <div class="box-header">
                    <div class="col-sm-5" style="padding-left: 0px">
                        <a href="#">请选择告警分组:</a>
                        <label>
                            <select name="alarmgroup" class="form-control m-b input-sm" onchange="change_info()">
                                {% for i in alarmgroup_info %}
                                {% ifequal i.id|int2str alarmgroup_id %}
                                <option value="{{ i.id }}" selected> {{ i.name|slice:":20" }}</option>
                                {% else %}
                                <option value="{{ i.id }}"> {{ i.name|slice:":20" }}</option>
                                {% endifequal %}
                                {% endfor %}
                            </select>
                        </label>
                    </div>
                </div>
                <!-- /.box-header -->
                <div class="box-body">
                    <table class="table table-striped table-bordered" id="dataform">
                        <thead>
                        <tr>
                            <th width="5%">
                                <input type="checkbox" onclick="checkAll(this, 'item1');"/>
                            </th>
                            <th>告警收件人</th>
                            <th>微信状态</th>
                            <th>邮件状态</th>
                            <th>短信状态</th>
                            <th>钉钉状态</th>
                            <th>电话状态</th>
                            <th class="text-center">功能</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% if obj_info %}
                            {% for obj in obj_info %}
                                <tr class="even gradeX">
                                    <td style="vertical-align:middle"><input type="checkbox" id="u_id" class="item1"
                                                                             value="{{ obj.id }}"
                                                                             name="g_check"/></td>
                                    <td style="vertical-align:middle"><a href="#">
                                        <li style="list-style-type:none" onclick="return tanchu(this.value)"
                                            value="{{ obj.id }}"> {{ obj.user.nickname }}</li>
                                    </a></td>
                                    <td style="vertical-align:middle">
                                        {% if obj.weixin_status %}
                                            <span class="label label-success">启用</span>
                                        {% else %}
                                            <span class="label label-default">禁用</span>
                                        {% endif %}
                                    </td>
                                    <td style="vertical-align:middle">
                                        {% if obj.email_status %}
                                            <span class="label label-success">启用</span>
                                        {% else %}
                                            <span class="label label-default">禁用</span>
                                        {% endif %}</td>
                                    <td style="vertical-align:middle">
                                        {% if obj.sms_status %}
                                            <span class="label label-success">启用</span>
                                        {% else %}
                                            <span class="label label-default">禁用</span>
                                        {% endif %}</td>
                                    <td style="vertical-align:middle">
                                        {% if obj.dd_status %}
                                            <span class="label label-success">启用</span>
                                        {% else %}
                                            <span class="label label-default">禁用</span>
                                        {% endif %}</td>
                                    <td style="vertical-align:middle">
                                        {% if obj.tel_status %}
                                            {% ifequal obj.tel_status 1 %}
                                                <span class="label label-success">启用-运维通道</span>
                                            {% else %}
                                                <span class="label label-success">启用-周杰通道</span>
                                            {% endifequal %}
                                        {% else %}
                                            <span class="label label-default">禁用</span>
                                        {% endif %}</td>
                                    <td style="vertical-align:middle" class="text-center" data-editable='false'>
                                        <a href="#">
                                            <li class="btn btn-sm btn-info" onclick="return tanchu(this.value)"
                                                value="{{ obj.id }}">编辑
                                            </li>
                                        </a>
                                    </td>
                                </tr>
                            {% endfor %}
                        {% else %}
                            <p>No Item are available.</p>
                        {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </form>

    </section>
    <!-- /.content -->
</div>
{#接收子层回传参数#}
<input id="handle_status" value="" hidden="hidden">
<script>
    function change_info() {
        var args = $("#form").serialize();
        window.location = "{% url 'monitor_index' %}?" + args
    }
    function checkAll(sender, checkClass) {
        var checkItems = document.getElementsByTagName('input');
        for (var i = 0; i < checkItems.length; i++) {
            var checkItem = checkItems[i];
            if (checkItem.type === 'checkbox' && checkItem.className === 'item1') {
                checkItem.checked = sender.checked;
            }
        }
    }
</script>
<script src="/static/plugins/datatables/jquery.dataTables.min.js"></script>
<script src="/static/plugins/datatables/dataTables.bootstrap.min.js"></script>
<script>
    $(function () {
        $('#dataform').DataTable({
            "paging": true,
            "lengthChange": true,
            "searching": true,
            "ordering": true,
            "info": true,
            "autoWidth": true
        });
    });
</script>
<script>
    function checkSubmit() {
        var app_id_all = getIDall();
        if (app_id_all == '') {
            alert("请至少选择一行!");
            return false;
        }
        if (!confirm("确定删除？")) {
            window.event.returnValue = false;
        }
    }
</script>
<script>
    function tanchu(n) {
        layer.open({
            type: 2,
            title: '修改用户告警策略',
            area: ['600px', '450px'],
            shadeClose: true, //点击遮罩关闭
            content: ['/skapi/monitor/alarmlistedit/' + n,],
            end: function () {
                var handle_status = $("#handle_status").val();
                if (handle_status == '1') {
                    layer.msg('保存成功！', {
                        icon: 1,
                        time: 2000 //2秒关闭（如果不配置，默认是3秒）
                    }, function () {
                        history.go(0);
                    });
                    var args = $("#form").serialize();
                    window.location = "{% url 'monitor_index' %}?" + args
                } else if (handle_status == '2') {
                    layer.msg('修改失败！', {
                        icon: 2,
                        time: 2000 //2秒关闭（如果不配置，默认是3秒）
                    }, function () {
                        history.go(0);
                    });
                }
            }
        });
    }
</script>
{% endblock %}
