<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    {% include 'link_css.html' %}
    {% include 'head_script.html' %}
{% block self_head_css_js %}
    <script src="/static/layer/layer.js"></script>
    <script src="/static/js/jquery.bootstrap-duallistbox.js"></script>
    <link rel="stylesheet" type="text/css" href="/static/css/bootstrap-duallistbox.css">
{% endblock %}
</head>
<body>
<div class="content-wrapper">


    <!-- Main content -->

    <section class="content">

<div id="dialog">
        <div class="box box-info">
            <!-- /.box-header -->
            <!-- form start -->
          <form action="{% url 'TaskCommit_add' ids %}" method="post">
            {% csrf_token %}
            {{ tpl_TaskCommit_form.as_p }}
            <input type="hidden" name="id" value="{{ obj.id }}">
            <input type="button" class="btn btn-info" style="width: 60pt"  onclick="taskcommit_checkstatus();taskcommit_check();" value="前置检查">&nbsp;&nbsp;&nbsp;&nbsp;
            <input type="submit" class="btn btn-danger" style="width: 60pt" value="提交">&nbsp;&nbsp;&nbsp;&nbsp;
      
          </form>
          
          <div class="box-footer with-border">
                <div id="message_box">{{ check_message }}</div>
		          <div id="prog_out" class="progress">
		          <div id="prog_in" class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" style="width: 45%">
		            
		          </div>
		        </div>
				</div>
      </div>
</div>

    </section>

  </div>
{#回传参数至父层#}
<script type="text/javascript">
        var index = parent.layer.getFrameIndex(window.name);
        var success = {{ status }};
        if ( success == '1' ) {
            parent.$("#handle_status").val('1');
            parent.layer.close(index);
        } else if( success == '2' ) {
            parent.$("#handle_status").val('2');
            parent.layer.close(index);
        }
</script>

<script type="text/javascript">
function taskcommit_checkstatus(){
	var obj_project=$("#id_project").val();
	var obj_env=$("#id_env").val();
	var sitv = setInterval(function(){	
		$.ajax({
			url:'/skdeploy/TaskCommit/checkstatus/',
			type:"POST",
			data:{project:obj_project,
				   env:obj_env,
				csrfmiddlewaretoken:'{{ csrf_token }}'},
			success:function(callback){
				var obj_json = jQuery.parseJSON(callback);
				$('#prog_in').width(obj_json + '%');
				
			}
		})
		
	},1000)
}
</script>

<script type="text/javascript">
function taskcommit_check(){
	var obj_project=$("#id_project").val();
	var obj_env=$("#id_env").val();
	$.ajax({
		url:'/skdeploy/TaskCommit/check/',
		type:"POST",
		data:{project:obj_project,
			   env:obj_env,
			csrfmiddlewaretoken:'{{ csrf_token }}'},
		
		success:function(callback){
				var obj_json = jQuery.parseJSON(callback);					
			/* 	alert(obj_json); */
			}
	
	})
	
;
}
</script>
</body>
</html>


